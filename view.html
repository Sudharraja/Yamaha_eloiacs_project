<?php

include_once 'conn.php';
include "nav.php";
if(isset($_POST['edit'])){

    $id=$_POST['ID'];
    $code = $_POST['sCODE'];
    $name = $_POST['sNAME'];
    $basic = $_POST['sBASIC'];
    $convenience = $_POST['sCONVENIENCE'];
    $advance = $_POST['sADVANCE'];
    $Overtime = $_POST['sOVER_TIME'];
    $employworking = $_POST['sTOTAL_DAYS'];
    $salary = $_POST['sSALARY'];
    $salarydate = $_POST['sSALARY_DATE'];
    $EPF12 = $_POST['sEPF12'];
    $EPF18 = $_POST['sEPF18'];
    $ESI075 = $_POST['sESI075'];
    $ESI325 = $_POST['sESI325'];
    $basicallowance = $_POST['sBASIC_ALLOWANCE'];
    $rentalallowance = $_POST['sRENTAL_ALLOWANCE'];
    $medicalallowance = $_POST['sMEDICAL_ALLOWANCE'];
    $lossofpay = $_POST['sLOSS_PAY'];
    $finalwrkngdays = $_POST['final_all_working_days'];

    $query = "UPDATE salary_data SET sCODE='$code', sNAME='$name', sBASIC='$basic', sCONVIENCE='$convenience', sADVANCE='$advance', sOVER_TIME='$Overtime', sTOTAL_DAYS='$employworking', sSALARY='$salary', sSALARY_DATE='$salarydate', sEPF12='$EPF12', sEPF18='$EPF18', sESI075='$ESI075', sESI325='$ESI325', sBASICALLOW='$basicallowance', sRENTALALLOW='$rentalallowance', sMEDICALALLOW='$medicalallowance', sLOSSPAY='$lossofpay', sFINALWORKINGDAYS='$finalwrkngdays' WHERE ID='$id'";

    
 
$query_run=mysqli_query($conn,$query);

if($query_run){
    
    ?>

    <script>
alert("Successfully Updated");
window.location.href='salary_storage_view.php';

    </script>

    <?php

}

else{
    ?>
    <script>
alert("Not Updated");
window.location.href='salary_storage_view.php';
    </script>

    <?php
}
}

$result=mysqli_query($conn,"SELECT * FROM salary_data where id='".$_GET['id']."'");

$row=mysqli_fetch_array($result);

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Employee Registration Form</title>
   
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
</head>
<style>
  .container111{
    width:100%;
    background-repeat: no-repeat;
    background-size: cover;
    background-image: url(box.jpg);
  }
  .container111 {
    /* left: 25px; */
    top: 61px;
    position: fixed;
}
.container1 {
  margin-bottom:40px; 
  background-color: white;
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
    border-radius: 10px;
    margin-top: 10px;
    
    margin-left: 300px;
    margin-right: 300px;
    text-align: center;
    height: 510px;
    
   
}
h1{

  color:orangered;
  margin-top: 11px;
  margin-bottom:30px;
  margin-right:21%;
}
table
{
    width: 100%;   

    font-size: 120%;
    font-family: serif;
    margin-left: 160px;
    margin-top: 30px;
    margin-right: 160px;
    font-weight: 600;
    text-align: left;
    display: flex;
    top: 20px;
}

table tr
{
    font-size: 80%;
    text-align: left;
}
.scroll-container {
        width: 100%; /* Set the desired width for the container */
        height:100%;/* Set the desired height for the container */
        overflow: auto;
        flex-direction: column;
        margin-left: 76px;
        margin-top:10%;
      
}


/* Customizing the scrollbar */
.scroll-container::-webkit-scrollbar {
    display: none; /* Set the width of the scrollbar */
  }
  
  button.btn-success{
    margin-top: 15px;
    width: 80px;
    font-weight: bold;
    margin-bottom: 30px;
    margin-left: 150px;
}
button.btn-success:hover{
    background-color: white;
    color: green;
}
input{
  width:80%;
  margin-top: 2.8px;
}
.row{
  margin-top:9px;
}
button#edit {
  margin-top:5%;
  margin-right:50%;
}
.view_edit_id{
  display:none;
}
select#wd {
    padding: 4px;
    width: 80%;
}
label{
  float:left;
}
input[readonly] {
    PADDING: 4PX;
    BORDER: NONE;
    background-color: #91858540;
}
.btn2{
  margin-left:5px;
  
    font-weight: 500;
    font-size: 18px;
}
.btn .btn-link{
position:absiolute;
}
.bg-color {
    margin-top: -30px;
}
.hide{
  display: block;
  margin-bottom: 20px;

}

</style>
<body>
<div class="container111">
  
<button class="btn2 btn btn-link"><a class="bbtn" href="salary_storage_view.php">Back</a></button>
  <div class="bg-color">

          <div class="container1">
            <div class="scroll-container">
          <h1>Edit Employee Salary</h1>
<form id="form" action="" method="post" >
<div class="row view_edit_id">
  <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>ID</label>
                </div>
                <div class="col-lg-6">
               <input type="text"  name="ID" value="<?php echo $row["ID"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>


<!----EDITABLE----------------------->


            

<div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Basic:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sBASIC" id="Basic" value="<?php echo $row["sBASIC"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Convenience:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sCONVENIENCE" id="Convenience" value="<?php echo $row["sCONVIENCE"]; ?>"  required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Advance:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sADVANCE" id="Advance" value="<?php echo $row["sADVANCE"]; ?>"  required>
                </div>
         

                        
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Over Time:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sOVER_TIME" id="ot" value="<?php echo $row["sOVER_TIME"]; ?>" >
                </div>
                <div class="col-lg-2"></div>
            </div>

             <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Working Days:</label>
                </div>
                <div class="col-lg-6">
               <input name="sTOTAL_DAYS" id="emp_working" value="<?php echo $row["sEMP_WORKING_DAYS"]; ?>" >
                </div>
                <div class="col-lg-2"></div>
            </div>
             
             <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Salary:</label>
                </div>
                <div class="col-lg-6">
              <input type="text" name="sSALARY" id="totalsalary" value="<?php echo $row["sSALARY"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>


            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>TOTAL WORKING DAYS:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="Total_no_of_days" id="Total_no_of_days" value="<?= $row['sTOTAL_DAYS']; ?>"  required>
                </div>

                <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>FInal working days</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="final_all_working_days" id="final_all_working_days" value=""  required>
                </div>

                <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>EPF:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sEPF_NUMBER" value="<?php echo $row["sEPF_NUMBER"]; ?>" readonly >
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>ESI:</label>
                </div>
                <div class="col-lg-6">
                 <input type="text" name="sESI_NUMBER" value="<?php echo $row["sESI_NUMBER"]; ?>" readonly >
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>LOP:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sLOSS_PAY" id="LOP_DAYS" value="<?php echo $row["sLOSSPAY"]; ?>" required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>EPF 12%:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" id="EPF12" name="sEPF12" value="<?php echo $row["sEPF12"]; ?>" readonly >
                </div>
                <div class="col-lg-2"></div>
            </div> <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>EPF 18%:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sEPF18" id="EPF18"value="<?php echo $row["sEPF18"]; ?>" readonly >
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>ESI 0.75%:</label>
                </div>
                <div class="col-lg-6">
              <input type="text" name="sESI075" id="esi75" value="<?php echo $row["sESI075"]; ?>" readonly >
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>ESI 3.25%:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sESI325" id="esi325"  value="<?php echo $row["sESI325"]; ?>" readonly></div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Basic Allowance:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sBASIC_ALLOWANCE" id="basicallowan" value="<?php echo $row["sBASICALLOW"]; ?>" readonly>
                </div>
                <div class="col-lg-2"></div>
            </div>
             <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Rental Allowance:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sRENTAL_ALLOWANCE" id="rentalallowan" value="<?php echo $row["sRENTALALLOW"]; ?>" readonly>
                </div>
                <div class="col-lg-2"></div>
            </div>
             <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Medical Allowance:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sMEDICAL_ALLOWANCE" id="medicalallowan" value="<?php echo $row["sMEDICALALLOW"]; ?>" readonly>
  
                </div>
                <div class="col-lg-2"></div>
            </div>

          <button class="btn btn-success" type="submit" id="edit" name="edit" >Edit</button>




<div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Employee Code:</label>
                </div>
                <div class="col-lg-6">
                <input type="text"  name="sCODE" value="<?php echo $row["sCODE"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Employee Name:</label>
                </div>
                <div class="col-lg-6">
             <input type="text"  name="sNAME"  value="<?php echo $row["sNAME"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
         

          <div class="hide">
          <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Date:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sSALARY_DATE" value="<?php echo $row["sSALARY_DATE"]; ?>" >
                </div>
                <div class="col-lg-2"></div>
            </div>
           

            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Bank Name:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sBANK_NAME" value="<?php echo $row["sBANK_NAME"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>Account No:</label>
                </div>
                <div class="col-lg-6">
               <input type="text" name="sACCOUNT_NUMBER" value="<?php echo $row["sACCOUNT_NUMBER"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            <div class="row">
            <div class="col-lg-1"></div>
                <div class="col-lg-3">
                    <label>IFSC Code:</label>
                </div>
                <div class="col-lg-6">
                <input type="text" name="sIFSC_CODE" value="<?php echo $row["sIFSC_CODE"]; ?>" readonly required>
                </div>
                <div class="col-lg-2"></div>
            </div>
            
          </div>     
</form>
</div>
      </div>
    </div>   
</div> 

<script>
 
 document.getElementById('emp_working').addEventListener('input', calculateTotalWorkingDays);

 document.getElementById('ot').addEventListener('input', calculateTotalWorkingDays);
 document.getElementById('Advance').addEventListener('input', calculateTotalWorkingDays);
 document.getElementById('Convenience').addEventListener('input', calculateTotalWorkingDays);
 document.getElementById('basicallowan').addEventListener('input',calculateTotalWorkingDays);
 document.getElementById('rentalallowan').addEventListener('input',calculateTotalWorkingDays);
 document.getElementById('medicalallowan').addEventListener('input',calculateTotalWorkingDays);

 function calculateTotalWorkingDays() {


   let company_basic_pay = parseFloat(document.getElementById('Basic').value);
   
   if (!isNaN(company_basic_pay)) {
               if (company_basic_pay <= 7000 || (company_basic_pay > 7000 && company_basic_pay <= 10000)) {

   let monthlyWorkingDays = parseInt(document.getElementById('Total_no_of_days').value);
   let employee_WorkingDays = parseInt(document.getElementById('emp_working').value);
   let exactDaysInput = document.getElementById('final_emp_working');
   let convenience = parseFloat(document.getElementById('Convenience').value);
   let ot = parseFloat(document.getElementById('ot').value);
   let advance = parseFloat(document.getElementById('Advance').value);
   let totalsalry = parseFloat(document.getElementById('totalsalary').value);
   let basicAllowance=parseFloat(document.getElementById('basicallowan').value);
   let RentaAllowance=parseFloat(document.getElementById('rentalallowan').value);
   let MedicalAllowance=parseFloat(document.getElementById('medicalallowan').value);
       let lopdays = parseFloat(document.getElementById('LOP_DAYS').value);
     


       

   if (monthlyWorkingDays === employee_WorkingDays) {
     employee_WorkingDays = monthlyWorkingDays - (-1);
   } else if (monthlyWorkingDays === employee_WorkingDays + 1) {
     employee_WorkingDays = monthlyWorkingDays;
   } else if (monthlyWorkingDays === employee_WorkingDays - (-2)) {
     employee_WorkingDays = monthlyWorkingDays - 1;
   } else if (monthlyWorkingDays === employee_WorkingDays - (-3) || monthlyWorkingDays > -(-3)) {
     exactDaysInput.value = employee_WorkingDays;
   }
 
  

   var perDaySalary = company_basic_pay / monthlyWorkingDays;
   var final_BasicSalary = perDaySalary * employee_WorkingDays;
   document.getElementById('totalsalary').value = final_BasicSalary;
   exactDaysInput.value = employee_WorkingDays;

   


   var epf_basic = final_BasicSalary * 30 / 100;
   var epf_employee = epf_basic * 0.12;
   var epf_company = epf_basic * 0.18;
   var esi_employee = epf_basic * 0.0075;
   var esi_company = epf_basic * 0.0325;
   var additional_allow = (company_basic_pay/monthlyWorkingDays)*employee_WorkingDays;
   var basic_allow = additional_allow *0.45;
   var rental_allow = additional_allow *0.25;
   var medical_allow = additional_allow *0.30;
   var convenience_final=(convenience/monthlyWorkingDays)*employee_WorkingDays
   var totalsalary_all_value = (convenience_final + ot + final_BasicSalary)-(advance+epf_employee+esi_employee);
   var lopdaysss= monthlyWorkingDays - employee_WorkingDays;

   document.getElementById('esi75').value = esi_employee.toFixed(2);
   document.getElementById('esi325').value = esi_company.toFixed(2);
   document.getElementById('EPF12').value = epf_employee.toFixed(2);
   document.getElementById('EPF18').value = epf_company.toFixed(2);
   document.getElementById('basicallowan').value = basic_allow.toFixed(2);
   document.getElementById('rentalallowan').value = rental_allow.toFixed(2);
   document.getElementById('medicalallowan').value = medical_allow.toFixed(2);
   document.getElementById('final_salary_fixed').value = totalsalary_all_value;
    document.getElementById('LOP_DAYS').value = lopdaysss;

   return;
 }

 else if (company_basic_pay > 10000) {
   let monthlyWorkingDays = parseInt(document.getElementById('Total_no_of_days').value);
   let employee_WorkingDays = parseInt(document.getElementById('emp_working').value);
   //let exactDaysInput = document.getElementById('final_emp_working');
   let convenience = parseFloat(document.getElementById('Convenience').value);
   let ot = parseFloat(document.getElementById('ot').value);
   let advance = parseFloat(document.getElementById('Advance').value);
   let totalsalry = parseFloat(document.getElementById('totalsalary').value);
       let lopdays = parseFloat(document.getElementById('LOP_DAYS').value);
       let employee_WorkingDays_epf = parseInt(document.getElementById('emp_working').value);

   if (monthlyWorkingDays === employee_WorkingDays) {
     employee_WorkingDays = monthlyWorkingDays - (-1);
   } else if (monthlyWorkingDays === employee_WorkingDays + 1) {
     employee_WorkingDays = monthlyWorkingDays;
   } else if (monthlyWorkingDays === employee_WorkingDays - (-2)) {
     employee_WorkingDays = monthlyWorkingDays - 1;
   } else if (monthlyWorkingDays === employee_WorkingDays - (-3) || monthlyWorkingDays > -(-3)) {
     exactDaysInput.value = employee_WorkingDays;
   }

   var perDaySalary = company_basic_pay / monthlyWorkingDays;
   var final_BasicSalary = perDaySalary * employee_WorkingDays;
   document.getElementById('totalsalary').value = final_BasicSalary;
   exactDaysInput.value = employee_WorkingDays;

  

   var epf_basic = (3334/monthlyWorkingDays)*employee_WorkingDays_epf;
   var epf_employee = epf_basic * 0.12;
   var epf_company = epf_basic * 0.18;
   var esi_employee = epf_basic * 0.0075;
   var esi_company = epf_basic * 0.0325;
   var convenience_final=(convenience/monthlyWorkingDays)*employee_WorkingDays
   var totalsalary_all_value = (convenience_final + ot + final_BasicSalary)-(advance+epf_employee+esi_employee);
   var lopdaysss= monthlyWorkingDays - employee_WorkingDays;


   document.getElementById('esi75').value = esi_employee.toFixed(2);
   document.getElementById('esi325').value = esi_company.toFixed(2);
   document.getElementById('EPF12').value = epf_employee.toFixed(2);
   document.getElementById('EPF18').value = epf_company.toFixed(2);
   document.getElementById('final_salary_fixed').value = totalsalary_all_value;
    document.getElementById('LOP_DAYS').value = lopdaysss;

   return;

}

}
else {
               // Invalid salary value
               document.getElementById("result").innerHTML = "Please provide a valid basic salary.";
           }
}
var inputs = document.querySelectorAll("#Basic");
       inputs.forEach(function(input) {
           input.addEventListener("input", calculateTotalWorkingDays);
       });
       calculateTotalWorkingDays();
</script>

</body>
</html>